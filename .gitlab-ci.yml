stages:
  - prepare
  - build

prepare:
  stage: prepare
  image: ubuntu:latest
  script:
    - echo "Preparing the environment"
    - apt-get update
    - apt-get install -y cmake g++ python3-pip python3-venv
    - python3 -m venv venv
    - . venv/bin/activate
    - pip install conan
    - echo "Conan installed"
  artifacts:
    paths:
      - venv/  # Save the virtual environment to be used by build
    expire_in: 1h
  only:
    - main

build:
  stage: build
  image: ubuntu:latest
  dependencies:
    - prepare
  script:
    - echo "Building the project"
    - apt-get update
    - apt-get install -y python3-venv
    - . venv/bin/activate
    - conan install . --build=missing
    - cmake .
    - make
  only:
    - main
